
---

### 一、了解: 文件系统基础
此部分介绍文件系统的基本概念和 Linux 中的主流类型。

*   **什么是文件系统?**
    *   文件系统是在存储设备上**组织、存储和读写文件**的管理方法。它定义了数据如何存储、如何被命名、访问和更新。格式化的过程就是在分区上创建（写入）一个空的文件系统。

*   **Linux 主流文件系统类型**:
    ![](assets/分区格式化/Linux主流文件系统类型.png)

---

### 二、格式化: 创建文件系统
此部分介绍如何使用 `mkfs` (make filesystem) 命令将一个分区格式化为指定的文件系统类型。

*   **格式化为 EXT4 文件系统**
    *   **功能**: 在指定分区上创建 ext4 文件系统。
    *   **核心命令**:
        ```bash
        # 使用 mkfs.ext4 命令
        mkfs.ext4 /dev/sdb1
      
        # 或者使用 mkfs -t <类型> 的通用格式
        mkfs -t ext4 /dev/sdb1
        ```

*   **格式化为 XFS 文件系统**
    *   **功能**: 在指定分区上创建 xfs 文件系统 (CentOS 7+ 推荐)。
    *   **核心命令**:
        ```bash
        # 使用 mkfs.xfs 命令
        mkfs.xfs /dev/sdc1
      
        # 如果分区已存在文件系统，需要加 -f 强制格式化
        mkfs.xfs -f /dev/sdc1
        ```

---

### 三、核心原理: 元数据、节点与块
此部分深入讲解文件系统的内部工作机制，解释文件是如何被存储和索引的。

*   **元数据 (Metadata)**
    *   **定义**: "描述数据的数据"。它包含了文件的所有属性信息，如文件名、大小、权限、所有者、时间戳以及最重要的——文件内容真正存储在哪些位置。

*   **inode (索引节点)**
    *   **定义**: 文件系统中用于存储**元数据**的核心数据结构。每个文件或目录都对应一个唯一的 inode。
    *   **包含内容**:
        *   文件权限 (rwx)
        *   文件所有者 (UID) 和所属组 (GID)
        *   文件大小
        *   时间戳 (创建、修改、访问时间)
        *   指向**数据块 (Block)** 的指针
    *   **关键点**: inode **不包含文件名**。文件名存储在目录的**数据块**中。

*   **数据块 (Block)**
    *   **定义**: 文件系统中存储**文件实际内容**的基本单位。一个文件通常由多个 Block 组成。

*   **文件名与 inode 的关系 (目录的作用)**
    *   **目录**本身也是一个文件，它的 inode 指向的数据块中存放的是一张“列表”。
    *   这张列表记录了该目录下所有**文件名**和其对应的 **inode 号码**之间的映射关系。
    *   当我们访问一个文件（如 `/home/user/file.txt`）时，系统会：
        1.  从根目录 `/` 开始，找到 `home` 目录的 inode。
        2.  读取 `home` 的数据块，找到 `user` 文件名对应的 inode。
        3.  读取 `user` 的数据块，找到 `file.txt` 文件名对应的 inode。
        4.  通过 `file.txt` 的 inode，最终找到存储文件内容的数据块。

---

### 四、全局管家: 超级块 (SuperBlock)
此部分介绍文件系统中最重要的全局控制结构。

*   **功能**:
    *   超级块 (SuperBlock) 记录了**整个文件系统的全局信息**。它就像是文件系统的“档案”或“总账本”。
    *   如果 Superblock 损坏，整个文件系统将无法被识别和挂载，后果非常严重。因此，文件系统会在多个块组中存放 Superblock 的备份。

*   **包含内容**:
    *   文件系统的类型和状态。
    *   **Block 和 inode 的总量**。
    *   **已使用和未使用的 Block 和 inode 数量**。
    *   Block 和 inode 的大小。
    *   文件系统的挂载时间、写入时间等信息。

*   **查看工具**:
    *   **核心命令**: `dumpe2fs` (适用于 ext2/3/4) 和 `xfs_info` (适用于 xfs)。
    *   **核心示例**:
        ```bash
        # 查看 ext4 文件系统的超级块信息
        dumpe2fs /dev/sdb1 | less
        ```