
---

### 了解: tar 命令 (归档与解归档)
此部分详细解释 `tar` 命令的各个参数及其作用。

*   **操作模式:**
    *   `-c, --create`: 创建一个新的归档文件。
    *   `-x, --extract`: 从归档文件中提取文件。
    *   `-t, --list`: 列出归档文件中的内容，不提取。
    *   `-r, --append`: 向一个已存在的归档文件末尾追加文件。
    *   `-u, --update`: 仅当文件比归档中的同名文件新时，才追加它。
    *   `-A, --catenate`: 将多个 tar 归档文件合并成一个。
    *   `--delete`: 从归档中删除指定的文件（不能用于磁带设备）。

*   **常用选项:**
	*    -a, 自动压缩/解压缩，根据压缩包的后缀名自动寻找合适的压缩工具，来执行压缩或解压缩。
	*   `-v, --verbose`: 显示详细的处理过程，列出每个被处理的文件。
    *   `-f, --file=ARCHIVE`: 指定归档文件的名称。这是最常用的选项之一。
    *   `-p, --preserve-permissions`: 在提取文件时，保留其原始权限和属性。
    *   `-j, --bzip2`: 通过 `bzip2` 过滤归档，用于创建或处理 `.tar.bz2` 文件。
    *   `-z, --gzip`: 通过 `gzip` 过滤归档，用于创建或处理 `.tar.gz` 文件。
    *   `-J, --xz`: 通过 `xz` 过滤归档，用于创建或处理 `.tar.xz` 文件。
    *   `--level=NUMBER`: 为压缩指定级别 (如 `gzip -#`)。
    *   `--exclude=PATTERN`: 在创建归档时，排除匹配 `PATTERN` 模式的文件。
    *   `--newer=DATE-OR-FILE`: 只归档比指定日期或文件更新的文件。
    *   `--acls` 或 `--no-acls`: 保留或不保留文件的 ACL 权限信息。
    *   `--selinux` 或 `--no-selinux`: 保留或不保留文件的 SELinux 安全上下文。
    *   `--xattrs` 或 `--no-xattrs`: 保留或不保留文件的扩展属性。
    *   `-g, --listed-incremental=FILE`: 处理增量备份。`FILE` 是快照文件，用于记录状态。
    *   `-C, --directory=DIR`: 在执行操作前，先切换到 `DIR` 目录。常用于解包到指定位置。

---
### 覆盖: 创建新归档 (备案)
*   **功能**：使用 `-c` 选项创建一个新的归档文件，如果同名文件已存在，则会**覆盖**它。
*   **核心示例**：
   ```bash
    tar -cf /tmp/amp.tar /tmp/dir01 /tmp/dir02
   ```

---
### 追加: 向归档包追加文件
*   **功能**：使用 `-r` 选项向已存在的归档文件末尾添加新的文件或目录。
*   **核心示例**：
   ```bash
    tar -rf /tmp/amp.tar /tmp/dir01/1.txt
   ```

---
### 更新: 更新归档包
*   **功能**：使用 `-u` 选项，比较归档内外文件的时间戳，仅将比归档中版本**更新**的文件追加进去。
*   **核心示例**：
   ```bash
    tar -uf /tmp/amp.tar /tmp/dir01
   ```

---
### 删除: 从归档包中删减文件
*   **功能**：使用 `--delete` 选项从归档文件中删除指定的文件。
*   **核心示例**：
   ```bash
    tar -f /tmp/dir02.tar --delete /tmp/dir02/d1/s1.txt
   ```

---
### 保留: 归档时保留文件特殊属性
*   **功能**：在归档时使用 `--acls` 和 `--selinux` 选项，以**保留**文件的访问控制列表 (ACL) 和 SELinux 安全上下文。
*   **核心示例**：
   ```bash
    tar -cf /tmp/dir03.tar --acls --selinux /tmp/dir03
   ```

---
### 排除: 归档时排除源文件和目录
*   **功能**：在创建归档时，使用 `--exclude` 选项忽略或**排除**指定的文件或目录。
*   **核心示例**：
   ```bash
    tar -cf /tmp/dir01.tar --exclude=/tmp/dir01/d2 /tmp/dir01
   ```

---
### 限制: 解归档时限制目录层级
*   **功能**：在解包时，使用 `--strip-components=<数字>` 选项**限制**（去除）指定层数的父目录结构。
*   **核心示例 (去除1层目录)**：
   ```bash
    tar -xf /tmp/etc.tar --strip-components=1
   ```

---
### 执行: 执行增量归档
*   **功能**：使用 `-g` 选项**执行**增量备份。首次为全量备份，之后为增量备份，只打包变化过的文件。
*   **核心示例 (首次全量备份)**：
   ```bash
    tar -g /root/snapshot.snar -zcf dir01.tar.gz /dir01
   ```
*   **核心示例 (后续增量备份)**：
   ```bash
    # (先修改/dir01中的文件)
    tar -g /root/snapshot.snar -zcf dir01-i.tar.gz /dir01
   ```

---
### 实战: 整机灾备归档与迁移恢复
*   **功能**：在**实战**场景中，对整个 Linux 系统进行备份和恢复。
*   **核心示例 (系统备份)**：
   ```bash
    tar -zcvpf /mnt/etc.tar.gz --exclude=/mnt --exclude=/proc --exclude=/sys --exclude=/run /
   ```
*   **核心示例 (系统恢复)**：
   ```bash
    tar -zxvpf /mnt/etc.tar.gz --overwrite -C /
   ```

---
