
---

## 第10章 以太网交换机工作原理

*   **MAC 地址学习**：
    *   **MAC 地址表初始化**：交换机启动时，MAC 地址表为空。当接收到数据帧时，交换机若不知道目的 MAC 地址，会将数据帧从所有端口转发出去（泛洪），效率较低。
    *   **MAC 地址学习过程**：
        *   当交换机接收到数据帧时，会学习数据帧的源 MAC 地址和接收端口的对应关系，并将其添加到 MAC 地址表中，形成 MAC 地址表项。
        *   **学习原则**：
            *   一个 MAC 地址只能被一个端口学习。如果同一个 MAC 地址从不同端口出现，交换机会更新其 MAC 地址表项。
            *   一个端口可学习多个 MAC 地址，例如当端口连接到 Hub，Hub 又连接多个主机时。
        *   **老化时间**：为了回收长时间不用的 MAC 地址表项空间，交换机会设定表项老化时间，未刷新的表项会被清除。
        *   **图示**：  
	        ![500](assets/第3篇%20配置局域网交换/MAC%20地址学习过程1.png)  
	        ![500](assets/第3篇%20配置局域网交换/MAC%20地址学习过程2.png)  
	        ![500](assets/第3篇%20配置局域网交换/MAC%20地址学习过程3.png)  
*   **交换机对数据帧的转发和过滤**：
    *   **单播帧的转发**：
        *   当交换机收到单播帧时，会查找 MAC 地址表。
        *   如果目的 MAC 地址存在于 MAC 地址表中，则将数据帧从对应的端口转发出去。
        *   如果目的 MAC 地址不在 MAC 地址表中，则会将数据帧从所有其他端口转发出去（泛洪）。  
        *   图示：  
	        ![500](assets/第3篇%20配置局域网交换/单播帧的转发.png)  
    *   **广播、组播和未知单播帧的转发**：交换机通常会将这类帧从除源端口外的所有其他端口转发出去，以确保网络中的所有相关设备都能收到。  
	    ![500](assets/第3篇%20配置局域网交换/广播、组播和未知单播帧的转发.png)  
    *   **数据帧的过滤**：
        *   当数据帧的目的 MAC 地址存在于 MAC 地址表中，并且目的 MAC 地址对应的端口与接收到帧的端口相同时，交换机会对该帧进行过滤，即不会转发出去。
        *   这通常发生在同一个端口连接多个设备（如通过 Hub 连接）且这些设备之间进行通信时。  
        *   图示：  
        ![500](assets/第3篇%20配置局域网交换/数据帧的过滤.png)  
*   **广播域**：
    *   **定义**：广播域是指广播帧能够到达的范围。二层交换机无法隔离广播域，因为它会将广播帧从除源端口外的所有端口转发出去。
    *   **路由器隔离广播**：路由器或三层交换机工作在网络层，能够对网络层信息进行操作。当路由器收到广播帧时，会对其进行解封装并根据 IP 地址路由，因此路由器不会转发广播帧，从而隔离了广播域。
    *   **减小广播域的意义**：减小广播域可以减少广播流量，提升网络性能，降低网络设备和主机的 CPU 负担。

---
## 第11章 配置VLAN

*   **VLAN 技术简介**：
    *   **产生背景**：在交换式以太网中，所有端口默认处于同一个广播域，导致广播风暴和网络资源浪费。为了解决这个问题，VLAN 技术应运而生。
    *   **作用**：VLAN（Virtual Local Area Network，虚拟局域网）技术将一个物理局域网划分为多个逻辑上的广播域，每个 VLAN 都是一个独立的广播域。
    *   **VLAN 隔离广播与路由器隔离广播**：
        *   路由器通过三层路由功能隔离广播域，将广播限制在每个接口所在的网络中。
        *   VLAN 技术通过在二层交换机上逻辑划分广播域，将广播限制在每个 VLAN 内部。不同 VLAN 间通信需要通过三层设备（如路由器或三层交换机）。
    *   **VLAN 优点**：
        *   **有效控制广播域范围**：将广播限制在 VLAN 内部，减少广播流量，节省带宽，提高网络处理能力。
        *   **增强局域网安全性**：不同 VLAN 间的报文默认隔离，提高了安全性。
        *   **灵活构建虚拟工作组**：用户可以根据功能或部门划分到不同 VLAN，不受物理位置限制，便于网络管理和维护。
*   **VLAN 类型**：
    *   **基于端口的 VLAN**：最简单和最常用的划分方式，将设备的端口指定到某个 VLAN。端口一旦加入某个 VLAN，就只能转发该 VLAN 的数据帧。
    *   **基于协议的 VLAN**：根据接收到的数据帧所属的协议类型（如 IP、IPX）来划分 VLAN。
    *   **基于子网的 VLAN**：根据数据帧的源 IP 地址和子网掩码来划分 VLAN。
*   **VLAN 技术原理**：
    *   **VLAN 标签**：为了在 VLAN 中区分数据帧，交换机给以太网帧附加一个标签（Tag），标记数据帧所属的 VLAN。
    *   **IEEE 802.1Q 帧格式**：
        *   在传统以太网帧中插入 4 个字节的 802.1Q 标签。
        *   **TPID (Tag Protocol Identifier)**：2 字节，固定值 0x8100，表示这是一个 802.1Q 标签帧。
        *   **TCI (Tag Control Information)**：2 字节，包含：
            *   **Priority**：3 位，指明数据帧优先级，共 8 种。
            *   **CFI (Canonical Format Indicator)**：1 位，指示帧是否为规范格式。
            *   **VLAN ID (VLAN Identifier)**：12 位，指明 VLAN 编号，共 4096 个。
    *   **单交换机 VLAN 标签操作**：
        *   当数据帧从非标签端口（Access 端口）进入交换机时，交换机会根据端口所属的 PVID（Port VLAN ID）给其打上 VLAN 标签。
        *   当数据帧从交换机端口发送出去时，如果目的端口是 Access 端口，交换机会剥离 VLAN 标签。
    *   **三种链路类型**：
        *   **Access 端口**：只允许默认 VLAN 的数据帧通过，通常不带 VLAN 标签。用于连接不需要识别 802.1Q 协议的终端设备（如 PC、路由器）。
        *   **Trunk 端口**：允许承载多个 VLAN 的数据帧通过，且数据帧通常带有 VLAN 标签。主要用于连接交换机之间，传输多个 VLAN 的数据。默认 VLAN 的帧在出端口时会被剥离标签。
        *   **Hybrid 端口**：比 Trunk 端口更灵活，可以同时接收和发送多个 VLAN 的数据帧，并且可以指定哪些 VLAN 的数据帧在出端口时被剥离标签，哪些不剥离。常用于连接交换机或服务器。
*   **H3C 设备 VLAN 基本配置**：
    *   **配置 VLAN**：
        1.  创建 VLAN 并进入 VLAN 视图：`vlan vlan-id`。
        2.  将指定端口加入到 VLAN 中：`port interface-list`。
    *   **配置 Trunk 端口**：
        1.  设置端口链路类型为 Trunk：`port link-type trunk`。
        2.  允许指定 VLAN 通过当前 Trunk 端口：`port trunk permit vlan { vlan-id-list | all }`。
        3.  设置 Trunk 端口的默认 VLAN（PVID）：`port trunk pvid vlan vlan-id`。
    *   **配置 Hybrid 端口**：
        1.  设置端口链路类型为 Hybrid：`port link-type hybrid`。
        2.  允许指定 VLAN 通过当前 Hybrid 端口，并指定是否剥离标签：`port hybrid vlan vlan-id-list { tagged | untagged }`。
        3.  设置 Hybrid 端口的默认 VLAN（PVID）：`port hybrid pvid vlan vlan-id`。
    *   **VLAN 显示及维护**：
        *   显示所有 VLAN 信息：`display vlan [brief]`。
        *   显示指定 VLAN 的详细信息：`display vlan vlan-id`。
        *   显示指定接口的 VLAN 信息：`display interface interface-type interface-number`。

---
## 第12章 生成树协议

*   **STP 产生背景**：
    *   **路径回环的影响**：在桥接网络中，如果存在冗余链路以提高可靠性，就会形成物理回环。数据帧在回环中会不断循环和增生，导致广播风暴、MAC 地址表不稳定、网络带宽被大量重复帧占用，最终造成网络拥塞，甚至瘫痪。
*   **STP 作用**：
    *   **消除回环**：通过阻断冗余链路，将有回环的桥接网络修剪成一个无回环的树型拓扑结构。
    *   **链路冗余备份**：当活动路径发生故障时，STP 会激活被阻断的冗余备份链路，恢复网络连通性。
*   **STP 介绍**：
    *   **定义**：STP（Spanning Tree Protocol，生成树协议），IEEE 802.1D 标准，用于在局域网中消除数据链路层物理环路。
    *   **工作原理**：设备通过交换 BPDU（Bridge Protocol Data Unit，桥协议数据单元）信息，发现网络中的环路，并有选择地阻塞端口，最终形成无环路的树型网络结构。
    *   **BPDU 报文**：
        *   **配置 BPDU (Configuration BPDU)**：用于生成树的计算和维护。包含根桥 ID、根路径开销、指定桥 ID、指定端口 ID 等信息。
        *   **TCN BPDU (Topology Change Notification BPDU)**：用于通知网络拓扑结构发生变化。
*   **STP 过程**：
    *   **根桥的选举**：网络中所有设备都有一个桥 ID，由桥优先级（BridgePriority）和 MAC 地址（BridgeMacAddress）组成。桥 ID 最小的设备被选举为根桥。
    *   **端口角色的确定**：
        *   **根桥上的所有端口**：均为指定端口（Designated Port）。
        *   **非根桥上**：
            *   **根端口 (Root Port)**：非根桥上到达根桥路径开销最小的端口。
            *   **指定端口 (Designated Port)**：每个物理段（链路）上到达根桥路径开销最小的桥的端口。
            *   **阻塞端口 (Blocked Port)**：既不是根端口也不是指定端口的端口，处于阻塞状态。
    *   **根路径开销 (RootPathCost)**：到达根桥的路径上所有链路开销（Cost）的总和。链路开销与带宽成反比，带宽越大，开销越小。
    *   **通过桥 ID 决定端口角色**：当根路径开销相同时，比较上游指定桥的桥 ID，桥 ID 最小的桥对应的端口被选为根端口或指定端口。
    *   **通过端口 ID 决定端口角色**：当根路径开销和指定桥 ID 都相同时，比较端口 ID（由端口索引号和端口优先级组成），端口 ID 最小的端口被选为根端口。
    *   **端口状态**：
        *   **Disabled (禁用)**：端口失效，不收发任何报文。
        *   **Blocking (阻塞)**：不转发数据帧，但接收和处理 BPDU。
        *   **Listening (侦听)**：不转发数据帧，不学习 MAC 地址，但接收和发送 BPDU。
        *   **Learning (学习)**：不转发数据帧，但学习 MAC 地址，接收和发送 BPDU。
        *   **Forwarding (转发)**：转发数据帧，学习 MAC 地址，接收和发送 BPDU。
    *   **端口状态迁移**：端口从 Blocking 状态到 Forwarding 状态需要经历 Listening 和 Learning 两个中间状态，每个状态默认持续 Forwarding Delay 时间（15 秒）。
*   **STP 的不足**：
    *   **收敛速度慢**：端口从阻塞状态到转发状态需要两倍的 Forwarding Delay 时间（默认 30 秒），导致网络拓扑变化时连通性恢复慢。
    *   **带宽利用率低**：所有 VLAN 共享一棵生成树，冗余链路被完全阻塞，无法实现负载分担，导致带宽浪费。
*   **RSTP 介绍和改进**：
    *   **RSTP (Rapid Spanning Tree Protocol，快速生成树协议)**：IEEE 802.1w 标准，是 STP 的优化版本，具备 STP 所有功能并实现了快速收敛。
    *   **快速收敛机制**：
        *   **端口角色快速切换**：当原根端口失效时，备用端口可快速成为新的根端口，无需等待 Forwarding Delay。
        *   **边缘端口 (Edge Port)**：直接连接终端设备的端口，可直接进入转发状态，无需等待。
        *   **P/A 协商机制 (Proposal/Agreement)**：通过端口之间的快速协商，使端口快速进入转发状态。
*   **STP 和 RSTP 的不足**：
    *   **所有 VLAN 共享一棵生成树**：在多 VLAN 环境下，所有 VLAN 共享一个生成树实例，无法实现 VLAN 级的负载分担，冗余链路被完全阻塞，带宽利用率仍然低下。
*   **PVST (Per VLAN Spanning Tree)**：
    *   **工作原理**：每个 VLAN 运行一个独立的 STP 或 RSTP 实例，不同 VLAN 之间的生成树完全独立。
    *   **优点**：可以在 Trunk 链路上实现 VLAN 级的负载分担，提高链路带宽利用率。
*   **MSTP (Multiple Spanning Tree Protocol，多生成树协议)**：
    *   **工作原理**：将多个 VLAN 捆绑到一个生成树实例（MSTI），每个 MSTI 运行一个独立的生成树。
    *   **优点**：既能实现 VLAN 级的负载分担，又减少了生成树实例的数量，降低了设备资源消耗。
*   **四种生成树协议对比**：
    *   **特性比较**：
        *   **解决环路故障并实现冗余备份**：STP、RSTP、PVST、MSTP 均支持。
        *   **快速收敛**：RSTP、PVST、MSTP 支持，STP 不支持。
        *   **形成多棵生成树实现负载分担**：PVST、MSTP 支持，STP、RSTP 不支持。
        *   **MSTP、PVST 具有 RSTP 的快速收敛，同时具有负载分担机制。**
        *   **MSTP 兼容 STP 和 RSTP。**
    *   **端口状态对比**：
        *   STP 有 5 种端口状态：Disabled、Blocking、Listening、Learning、Forwarding。
        *   RSTP/PVST/MSTP 将 Disabled、Blocking、Listening 合并为 **Discarding** 状态，总共有 3 种端口状态：Discarding、Learning、Forwarding。

---
## 第13章 交换机端口安全技术

*   **802.1X 基本原理和配置**：
    *   **802.1X 技术简介**：
        *   **定义**：IEEE 802.1X 是一种基于端口的网络接入控制协议，用于对局域网用户进行认证。
        *   **产生背景**：起源于无线局域网 802.11，后应用于有线局域网，解决用户接入网络的认证问题。
        *   **作用**：在端口级别对接入设备进行认证和控制，只有通过认证的设备才能访问网络资源。
    *   **802.1X 体系结构**：
        *   **客户端 (Supplicant System)**：安装有 802.1X 客户端软件的用户终端设备，支持 EAPOL（Extensible Authentication Protocol over LANs）协议。
        *   **设备端 (Authenticator System)**：支持 802.1X 协议的网络设备（如交换机），为客户端提供接入端口，认证通过后开放端口。
        *   **认证服务器 (Authentication Server System)**：对用户进行认证、授权和计费。
            *   **本地认证服务器**：集成在设备端，适用于小型网络。
            *   **远程集中认证服务器**：独立的认证服务器（如 RADIUS 服务器），适用于大规模网络。
    *   **端口接入控制方式**：
        *   **基于端口的认证**：端口下的第一个用户认证成功后，所有用户都可以使用网络资源。第一个用户下线后，所有用户被拒绝。
        *   **基于 MAC 地址的认证**：端口下的每个用户都需要单独认证。某个用户下线后，只有该用户无法使用网络。
    *   **802.1X 基本配置**：
        1.  全局启用 802.1X 特性。
        2.  在端口视图下启用 802.1X 特性。
        3.  添加本地接入用户并设置相关参数（用户名、密码、服务类型）。
*   **端口隔离技术及其配置**：
    *   **端口隔离简介**：
        *   **定义**：实现同一 VLAN 内部端口之间的二层数据隔离，防止隔离组内端口之间直接通信。
        *   **作用**：提供更安全、更灵活的组网方案，例如隔离用户端口，防止用户之间互相攻击。
    *   **端口隔离基本配置**：
        1.  创建隔离组：`port-isolate group group-number`。
        2.  将指定端口加入到隔离组中：`port-isolate enable group group-number`。
        3.  显示配置信息：`display link-aggregation summary|verbose`。

---
## 第14章 配置链路聚合

*   **链路聚合简介**：
    *   **作用**：将多条物理以太网链路捆绑成一个逻辑链路，提高带宽和可靠性。
    *   **优点**：
        *   **增加链路带宽**：数据流分散到聚合组的各个成员端口，实现负载分担。
        *   **提供链路可靠性**：实时监控成员端口状态，当某个端口故障时，数据流会自动切换到其他正常端口。
    *   **负载分担原理**：系统根据一定的算法，将不同的数据流分布到聚合组的各成员端口上。
*   **链路聚合的分类**：
    *   **静态聚合**：
        *   双方设备间不使用聚合协议协商链路信息。
        *   适用于一方设备不支持聚合协议或双方设备协议不兼容的情况。
    *   **动态聚合**：
        *   双方设备间使用 LACP（Link Aggregation Control Protocol，链路聚合控制协议）协商链路信息。
        *   LACP 是一种基于 IEEE 802.3ad 标准的协议，通过交换 LACPDU（Link Aggregation Control Protocol Data Unit）来动态实现链路聚合。
*   **链路聚合的基本配置**：
    *   **静态聚合配置**：
        1.  创建聚合端口：`interface bridge-aggregation interface-number`。
        2.  将以太网端口加入聚合组：`port link-aggregation group number`。
        3. 显示配置信息 `display port link-aggregation summary|verbose`。

---
## 第15章 配置WLAN

*   **WLAN 网络的基本概念**：
    *   **WLAN 相关设备**：
        *   **STA (Station，站点)**：带有无线网卡的终端设备，如 PC、手机。
        *   **AP (Access Point，无线接入点)**：提供无线客户端到局域网的桥接功能，实现无线到有线和有线到无线帧的转换。分为 FAT AP（胖 AP）、FIT AP（瘦 AP）和云 AP。
            *   **FAT AP**：独立运行，具备路由、安全等功能，适用于小型无线网络。
            *   **FIT AP**：由无线控制器集中管理，只提供射频功能，适用于大型无线网络。
            *   **云 AP**：支持云管理平台远程管理和运维。
        *   **AC (Access Controller，无线控制器)**：集中控制和管理 FIT AP 及 STA，提供接入认证服务。
        *   **PoE 交换机**：通过以太网向 AP 供电，简化布线。
    *   **WLAN 常见组网方式**：
        *   **FAT AP 方式**：FAT AP 独立管理接入终端，适用于小型无线网络。
        *   **AC+FIT AP 方式**：AC 集中管理 FIT AP，适用于大中型无线网络。
        *   **云管理平台+云 AP 方式**：云管理平台远程管理云 AP，适用于多分支、分布式无线网络。
    *   **WLAN 网络的基本拓扑**：
        *   **SSID (Service Set ID)**：服务集识别码，即无线网络名称，用于区分不同的无线网络。
        *   **无线服务模板**：SSID、认证方式等无线服务属性的集合，绑定到 AP 的射频口对外提供无线接入。
        *   **Radio (无线射频)**：用于无线设备发射信号（2.4G 频段、5G 频段）。
*   **WLAN 的配置方式**：
    *   **通过 Web 方式配置 Fat AP 或云 AP**：
        *   **登录 AP**：通过浏览器访问 AP 的 IP 地址或域名，输入用户名密码登录。
        *   **配置 AP**：在 Web 界面进行各项配置，如无线服务、网络设置等。
    *   **AC+Fit AP 组网配置命令**：
        *   **配置无线服务**：
            1.  创建服务模板并进入视图：`wlan service-template service-template-number`。
            2.  设置 SSID：`ssid ssid-name`。
            3.  配置无线客户端所属 VLAN：`vlan vlan-id`。
            4.  启用服务模板：`service-template enable`。
        *   **配置 AP**：
            1.  创建并进入 AP 管理模板视图：`wlan ap ap-name [ model model-name ]`。
            2.  配置 AP 的序列号：`serial-id [ text | auto ]`。
            3.  将服务模板绑定到射频：`service-template service-template-name`。
            4.  开启 AP 的射频：`radio enable`。

---